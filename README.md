# MSP Operations Plan

> å°ˆæ¡ˆä»£è™Ÿï¼šMSP_Operations_Plan_20251105  
> ç‰ˆæœ¬ï¼š1.0  
> æ›´æ–°æ—¥æœŸï¼š2025/11/05

æœ¬æ–‡æª”ç‚ºå°‡ Cisco Meraki é¡ç”¢å“ï¼ˆä»¥ä¸‹ç°¡ç¨± Merakiï¼‰ç”¨æ–¼ Managed Service Provider (MSP) ç‡Ÿé‹çš„é«˜éšèˆ‡å¯¦ä½œè¨ˆç•«ï¼Œé‡é»æ¶µè“‹æœå‹™ç›£æ§ã€å¸³å‹™ç®¡ç†ã€åœ¨ AWS ä¸Šçš„æŠ€è¡“æ¶æ§‹ã€å®‰å…¨èˆ‡åˆè¦ã€SLA èˆ‡æ—¥å¸¸é‹ç¶­æµç¨‹ã€‚

---

## ç›®æ¨™

- æä¾›å¯é‡æ¸¬ã€å¯è¿½è¹¤ã€å¯è‡ªå‹•åŒ–çš„ Meraki-based MSP ç‡Ÿé‹æµç¨‹ã€‚
- å»ºç«‹é›†ä¸­ç›£æ§ã€äº‹ä»¶é€šçŸ¥èˆ‡è‡ªå‹•åŒ–å›æ‡‰æ©Ÿåˆ¶ï¼Œé™ä½ MTTRã€‚
- å»ºç½®å¸³å‹™ç³»çµ±æ”¯æ´å¤šç§Ÿæˆ¶è¨ˆåƒ¹ï¼ˆå®šé¡èˆ‡ç”¨é‡æ··åˆï¼‰ã€ç™¼ç¥¨èˆ‡æœƒè¨ˆæ•´åˆã€‚
- åœ¨ AWS ä¸Šä½¿ç”¨å¯æ“´å……ã€å¯è§€å¯Ÿçš„åŸºç¤è¨­æ–½ä»¥æ”¯æ´é•·æœŸç‡Ÿé‹ã€‚

## ç¯„åœ

- æ”¯æ´çš„è¨­å‚™ï¼šMeraki MR(AP)ã€MX(SD-WAN/Firewall)ã€MS(Switch)ã€SM(è£ç½®ç®¡ç†)
- ä¸»è¦åŠŸèƒ½ï¼šä½ˆå»º/æ‹†é™¤ã€ç›£æ§/å‘Šè­¦ã€å¸³å‹™/è¨ˆè²»ã€å ±è¡¨ã€æ›´æ–°ç®¡ç†ã€äº‹ä»¶/å•é¡Œè™•ç†
- ä¸åŒ…å«ï¼šå®¢æˆ¶å…§éƒ¨å°ˆå±¬é Meraki è¨­å‚™æ·±åº¦æ”¯æ´ï¼ˆé™¤éå¦è¡Œåˆç´„ï¼‰

## ç‡Ÿé‹åˆç´„èˆ‡æœå‹™ï¼ˆå»ºè­°ï¼‰

- åŸºæœ¬æœå‹™ï¼šè¨­å‚™ç›£æ§ã€é ç«¯æ•…éšœæ’æŸ¥ã€éŸŒé«”ç¶­è­·å»ºè­°ã€æœˆåº¦å ±è¡¨
- é€²éšæœå‹™ï¼š24x7 SLAã€å®šæœŸç¶²è·¯å„ªåŒ–ã€é…ç½®è®Šæ›´ç®¡ç†ã€ç¾å ´æ”¯æ´ï¼ˆé¸é…ï¼‰
- å¸³å‹™æ¨¡å¼ï¼šæœˆç§Ÿåˆ¶ï¼ˆè¨­å‚™/æœå‹™ï¼‰+ ç”¨é‡è¨ˆè²»ï¼ˆè¶…é¡æµé‡ã€å®¢æˆ¶æ•¸ã€VPN é€šé“æ•¸ï¼‰+ æˆæ¬Šä»£æ”¶/ä»£ä»˜

## AWS æŠ€è¡“æ¶æ§‹å»ºè­°

é«˜éšå…ƒä»¶ï¼ˆæœ€å°å¯è¡ŒæŠ€è¡“ï¼‰ï¼š

- VPCï¼ˆå¤š AZï¼‰: å…¬ç§å­ç¶²åˆ†é›¢ï¼ŒNATã€Bastion ä¸»æ©Ÿï¼ˆæˆ– Session Managerï¼‰
- EKS / ECSï¼šéƒ¨ç½²ç›£æ§èˆ‡å¸³å‹™å¾®æœå‹™ï¼ˆå»ºè­° EKS + Fargate æˆ–è‡ªå‹•æ“´ç¸®çš„ ECSï¼‰
- RDSï¼ˆPostgresï¼‰: å¸³å‹™/è¨‚é–±è³‡æ–™å„²å­˜ï¼ˆMulti-AZ, è‡ªå‹•å‚™ä»½ï¼‰
- S3ï¼šé•·æœŸæ—¥èªŒã€å ±è¡¨ã€ç™¼ç¥¨ PDF å„²å­˜ï¼ˆè¨­å®š Lifecycleï¼‰
- CloudWatch + CloudTrail + Configï¼šAWS åˆè¦ã€ç¨½æ ¸èˆ‡æŒ‡æ¨™
- Prometheus + Grafanaï¼ˆå¯åœ¨ EKSï¼‰ï¼šMeraki èˆ‡å…§éƒ¨æœå‹™æŒ‡æ¨™ã€å®¢è£½åŒ–å„€è¡¨æ¿
- Alertmanager / SNS / PagerDutyï¼šå‘Šè­¦è·¯ç”±èˆ‡ç­è¡¨æ•´åˆ
- API Gateway + Lambdaï¼šè™•ç†ä¾†è‡ª Meraki Webhooks çš„äº‹ä»¶ä¸¦è§¸ç™¼å·¥ä½œæµç¨‹
- Secrets Manager / Parameter Storeï¼šä¿å­˜ API Keysã€DB å¯†ç¢¼

ç¶²è·¯èˆ‡å®‰å…¨ï¼š

- ALB / NLBï¼ˆå¿…è¦æ™‚ï¼‰
- å­ç¶²èˆ‡å®‰å…¨ç¾¤çµ„æœ€å°æ¬Šé™
- VPC Flow Logsï¼ˆè¼¸å…¥è‡³ S3 æˆ– CloudWatch Logsï¼‰

å‚™æ´èˆ‡å‚™ä»½ï¼šRDS è‡ªå‹•å‚™ä»½ã€å¤šå€éƒ¨ç½²ï¼›S3 ç‰ˆæœ¬èˆ‡ Lifecycleï¼›é‡è¦å¿«ç…§å®šæœŸä¿ç•™

æˆæœ¬æ§åˆ¶å»ºè­°ï¼šä½¿ç”¨ Savings Plans/Reserved Instancesã€S3 Lifecycleã€EKS èŠ‚ç‚¹è‡ªåŠ¨æ‰©ç¼©ä¸ Fargate

## ç›£æ§éœ€æ±‚ï¼ˆService Monitoringï¼‰

ç›£æ§ç›®æ¨™ï¼šå¯å³æ™‚æŒæ¡è¨­å‚™/ç¶²è·¯èˆ‡æœå‹™å¥åº·ç‹€æ…‹ï¼Œä¸¦èƒ½è‡ªå‹•åŒ–åˆ†ç´šé€šå ±èˆ‡å›æ‡‰ã€‚

ç›£æ§é …ç›®ï¼ˆåˆ†é¡ï¼‰ï¼š

- è¨­å‚™ç”Ÿå‘½é€±æœŸèˆ‡é€£ç·š
  - è¨­å‚™åœ¨ç·š/é›¢ç·šç‹€æ…‹
  - å®¢æˆ¶é€£ç·šæ•¸ (client count)ã€SSID ä½¿ç”¨é‡
  - POE/Port ç‹€æ…‹ã€ç«¯å£éŒ¯èª¤ç‡
  - AP èˆ‡ Switch çš„ Channel/Tx/Rx/Throughput

- ç¶²è·¯èˆ‡æœå‹™å±¤
  - WAN é€£ç·šå“è³ªï¼ˆå»¶é²ã€ä¸ŸåŒ…ã€æŠ–å‹•ï¼‰ã€BGP/å‹•æ…‹è·¯ç”±ç‹€æ…‹
  - VPN éš§é“ç‹€æ…‹èˆ‡é‡é€£æ¬¡æ•¸
  - NAT/Firewall è¦å‰‡è§¸ç™¼æ•¸ã€æ‹’çµ•æµé‡

- å®‰å…¨æ€§
  - IPS/IDS äº‹ä»¶ï¼ˆè‹¥ Meraki æä¾›ï¼‰
  - éé æœŸçš„å¤§é‡æµé‡/æƒæè¡Œç‚º
  - å¸³æˆ¶/API Key çš„å¯ç–‘æ´»å‹•

- ç‡Ÿé‹æœå‹™
  - ç›£æ§æœå‹™ï¼ˆPrometheus æŒ‡æ¨™ã€Exporter å¥åº·ï¼‰
  - å¸³å‹™è™•ç†éšŠåˆ—é•·åº¦ã€ç™¼ç¥¨ç”¢ç”Ÿå¤±æ•—ç‡

æŒ‡æ¨™èˆ‡é‡æ¸¬æ–¹å¼ï¼š

- MTTDï¼ˆå¹³å‡åµæ¸¬æ™‚é–“ï¼‰, MTTRï¼ˆå¹³å‡ä¿®å¾©æ™‚é–“ï¼‰
- å¯ç”¨æ€§ï¼šè¨­å‚™ UP-timeã€æœå‹™ SLAï¼ˆ99.9% etc.ï¼‰
- å‘Šè­¦ç­‰ç´šï¼šCritical / Major / Minor / Infoï¼Œä¸¦å°æ‡‰ Escalation Policy

å‘Šè­¦è¦å‰‡èˆ‡æµï¼š

1. Meraki Webhooks -> API Gateway -> Lambda -> å°‡äº‹ä»¶å¯«å…¥ Kafka/SQS æˆ–ç›´æ¥æ¨åˆ° Prometheus Pushgateway / Metrics DB
2. Prometheus/Grafana è¨­å®šé–€æª»è­¦ç¤º -> Alertmanager -> SNS/PagerDuty/Email/Slack
3. Critical äº‹ä»¶è‡ªå‹•é–‹ç«‹ Ticketï¼ˆæ•´åˆ ServiceNow / Jira Service Deskï¼‰ä¸¦è§¸ç™¼æŒ‡å®š on-call

Runbook ç¯„ä¾‹ï¼ˆæ¯å€‹å¸¸è¦‹å‘Šè­¦éœ€å°æ‡‰ Runbookï¼‰ï¼š

- è¨­å‚™é›¢ç·šï¼šæª¢æŸ¥æœ€å¾Œå¿ƒè·³ã€æª¢æŸ¥å®¢æˆ¶ç«¯é›»æº/ç¶²è·¯ã€é ç«¯é‡å•ŸæŒ‡ä»¤ã€é€šçŸ¥ç¾å ´
- VPN æ‰ç·šï¼šæª¢æŸ¥å°ç«¯ç‹€æ…‹ã€é‡æ–°å»ºç«‹éš§é“ã€å›å ±åˆ°å®¢æˆ¶

è³‡æ–™ä¿ç•™ï¼šç›£æ§åŸå§‹äº‹ä»¶ 90 å¤©ï¼ŒèšåˆæŒ‡æ¨™ 2 å¹´ï¼ˆå¯ä¾åˆç´„èˆ‡æ³•è¦èª¿æ•´ï¼‰

## å¸³å‹™ç®¡ç†éœ€æ±‚ï¼ˆBilling & Accountingï¼‰

åŠŸèƒ½éœ€æ±‚ï¼š

- å¤šç§Ÿæˆ¶å¸³å‹™æ¨¡å‹ï¼ˆæ¯å€‹å®¢æˆ¶ä¸€å€‹ tenant idï¼‰
- æ”¯æ´æ··åˆè¨ˆè²»ï¼šå›ºå®šæœˆè²» + ç”¨é‡ï¼ˆæµé‡ã€AP æ•¸é‡ã€å®¢æˆ¶æ•¸ã€æ”¯æ´ç´šåˆ¥ç­‰ï¼‰
- æˆæ¬Š/è»Ÿé«”è²»ç”¨ä»£æ”¶ä»£ä»˜ï¼ˆpass-throughï¼‰èˆ‡ä»£ç†åƒ¹å·®ç®¡ç†
- ç™¼ç¥¨è‡ªå‹•ç”¢ç”Ÿï¼ˆPDFï¼‰ã€é›»å­ç™¼ç¥¨æ”¯æ´
- æ”¯æ´å¤šç¨®æ”¯ä»˜æ–¹å¼ï¼ˆéŠ€è¡Œè½‰å¸³ã€ä¿¡ç”¨å¡ã€ ACH / Stripe / Payment Gatewayï¼‰
- æ¬Šé™åˆ†ç´šï¼šå¸³å–®ç®¡ç†å“¡ã€ç¨½æ ¸è§€çœ‹ã€æœƒè¨ˆæ•´åˆè§’è‰²
- æŠ˜æ‰£ã€ä¿ƒéŠ·ã€å¥‘ç´„æœŸèˆ‡çºŒç´„ç®¡ç†
- è¨˜å¸³æ•´åˆï¼ˆå¦‚ QuickBooksã€Xeroï¼‰ã€ç¨…å‹™è¨ˆç®—èˆ‡åœ°å€ç¨…ç‡

è³‡æ–™æ¨¡å‹ï¼ˆå»ºè­°æœ€å°æ¬„ä½ï¼‰ï¼š

- Customer (id, name, billing_cycle, billing_contact)
- Subscription (id, customer_id, sku, quantity, unit_price, billing_model, start_date, end_date)
- UsageRecord (id, subscription_id, metric, value, period_start, period_end)
- Invoice (id, customer_id, amount, due_date, status, pdf_s3_key)

è¨ˆè²»æµç¨‹ï¼ˆé«˜éšï¼‰ï¼š

1. æ¯æ—¥/æ¯å°æ™‚æ”¶é›†ä½¿ç”¨é‡ï¼ˆLambda / EKS jobï¼‰ -> å¯«å…¥ Usage DB
2. æœˆæœ«/è¨ˆè²»é€±æœŸåŸ·è¡Œè¨ˆåƒ¹å¼•æ“ï¼Œç”¢ç”Ÿ Invoice è‰ç¨¿
3. å¯©æ ¸ -> ç™¼é€ï¼ˆEmail + å­˜ S3ï¼‰ï¼Œä¸¦æ›´æ–°æœƒè¨ˆç³»çµ±
4. ä»˜æ¬¾å›å‘¼è™•ç†ã€é€¾æœŸè¿½è¹¤ã€é€€æ¬¾/èª¿æ•´

ç¨½æ ¸èˆ‡å ±è¡¨ï¼š

- æœˆåº¦ç‡Ÿæ”¶å ±è¡¨ã€å®¢æˆ¶è²¢ç»å ±è¡¨ã€æˆæ¬Šæˆæœ¬å ±è¡¨
- å°å¸³æ©Ÿåˆ¶ï¼šå°‡ç™¼ç¥¨èˆ‡å¯¦éš›æ”¶æ¬¾æ¯”å°ï¼Œå»ºç«‹èª¿æ•´æµç¨‹

å®‰å…¨èˆ‡åˆè¦ï¼š

- æ•æ„Ÿè³‡è¨Šï¼ˆä¿¡ç”¨å¡ï¼‰ä¸å„²å­˜åœ¨è‡ªå»ºç³»çµ±ï¼Œä½¿ç”¨ PCI-compliant Payment Processorï¼ˆStripeã€Adyenï¼‰
- ç™¼ç¥¨èˆ‡å¸³å‹™æ†‘è­‰ä¿ç•™æœŸé™ä¾åœ°å€æ³•è¦ï¼ˆå»ºè­°è‡³å°‘ 7 å¹´ï¼‰

## é‹ç¶­æµç¨‹èˆ‡ Runbooks

ä¸Šç·šå‰æª¢æŸ¥æ¸…å–®ï¼ˆOnboardingï¼‰:

1. å®¢æˆ¶è³‡æ–™èˆ‡åˆç´„ä¸Šå‚³
2. Meraki çµ„ç¹”èˆ‡ Network å»ºç«‹ã€API Key é…ç½®
3. åŸºæœ¬ç›£æ§æŒ‡æ¨™ã€å‘Šè­¦é–€æª»è¨­å®š
4. å¸³å‹™è¨‚é–±å»ºç«‹ã€è©¦ç®—ç™¼ç¥¨èˆ‡ç¨…å‹™æª¢æŸ¥
5. æ¸¬è©¦äº‹ä»¶æ¼”ç·´ï¼ˆå‘Šè­¦èˆ‡å·¥å–®æµï¼‰

æ—¥å¸¸é‹ç¶­ï¼ˆå»ºè­°ï¼‰:

- æ¯æ—¥ï¼šè‡ªå‹•å·¡æª¢ï¼ˆè¨­å‚™å¿ƒè·³ã€é—œéµæœå‹™æŒ‡æ¨™ï¼‰ã€ç™¼ç¥¨/ä»˜æ¬¾è™•ç†æª¢æŸ¥
- æ¯é€±ï¼šå®‰å…¨è£œä¸èˆ‡éŸŒé«”æ›´æ–°çª—å£ç®¡ç†ã€æµé‡è¶¨å‹¢æª¢æŸ¥
- æ¯æœˆï¼šå¸³å‹™å°å¸³ã€SLA å ±è¡¨ã€å‚™ä»½é©—è­‰

äº‹æ•…å›æ‡‰ï¼ˆç°¡åŒ–æµç¨‹ï¼‰ï¼š

1. åµæ¸¬ï¼ˆç›£æ§ï¼‰ -> 2. åˆ†ç´š -> 3. å»º Ticket -> 4. åˆæ­¥ç·©è§£ï¼ˆè‡ªå‹•åŒ–è…³æœ¬ï¼‰ -> 5. è©•ä¼°èˆ‡ä¿®å¾© -> 6. Root Cause åˆ†æ -> 7. é€šå ±èˆ‡è¨˜éŒ„

## SLA èˆ‡ KPI

- å»ºè­°é è¨­ SLA å±¤ç´šï¼š
  - Gold: 99.95% å¯ç”¨æ€§ã€1 å°æ™‚å›æ‡‰ã€4 å°æ™‚ä¿®å¾©ç›®æ¨™ï¼ˆè¦–æƒ…æ³ï¼‰
  - Silver: 99.9% å¯ç”¨æ€§ã€4 å°æ™‚å›æ‡‰ã€24 å°æ™‚ä¿®å¾©ç›®æ¨™
  - Bronze: 99.0% å¯ç”¨æ€§ã€å·¥ä½œæ—¥å›æ‡‰

é—œéµ KPIï¼šMTTDã€MTTRã€å®¢æˆ¶æ»¿æ„åº¦ï¼ˆCSATï¼‰ã€æ¯ç§Ÿæˆ¶æœˆç‡Ÿæ”¶ã€æµå¤±ç‡

## å®‰å…¨èˆ‡åˆè¦

- èº«åˆ†èˆ‡å­˜å–ç®¡ç†ï¼ˆIAM æœ€å°æ¬Šé™ã€MFAï¼‰
- API Key ç®¡ç†ï¼ˆå®šæœŸè¼ªæ›¿ã€å„²å­˜åœ¨ Secrets Managerï¼‰
- æ—¥èªŒèˆ‡ç¨½æ ¸ï¼ˆCloudTrailã€Meraki Audit logsï¼‰
- è³‡æ–™åŠ å¯†ï¼ˆå‚³è¼¸ TLS, S3 èˆ‡ RDS at-rest encryptionï¼‰
- éš±ç§æ³•è¦ï¼ˆä¾å®¢æˆ¶æ‰€åœ¨åœ°éµå®ˆ GDPR / CCPA ç­‰ï¼‰

## äººåŠ›èˆ‡è§’è‰²å»ºè­°

- Site Reliability Engineer (1-2)ï¼šç›£æ§ã€äº‹ä»¶å›æ‡‰ã€Runbook ç¶­é‹
- Network Engineer (1)ï¼šMeraki é…ç½®ã€ç¶²è·¯è¨ºæ–·
- Billing/Finance (1)ï¼šç™¼ç¥¨èˆ‡æœƒè¨ˆæ•´åˆ
- Support / NOCï¼ˆè¦–å®¢æˆ¶é‡ï¼‰ï¼šè¼ªç­ on-call

## å¯¦ä½œé‡Œç¨‹ç¢‘ï¼ˆå»ºè­°ï¼‰

1. ç¬¬ 0 é€±ï¼šéœ€æ±‚ç¢ºèªã€åˆç´„èˆ‡è¨ˆåƒ¹æ¨¡å‹è‰æ¡ˆ
2. é€± 1-2ï¼šAWS å¸³è™Ÿèˆ‡åŸºç¤ VPCã€IAMã€Secrets å¸ƒç½²
3. é€± 3-4ï¼šç›£æ§å †ç–Šï¼ˆPrometheus/Grafanaï¼‰ã€Webhook è™•ç†ç®¡ç·šã€å‘Šè­¦ç­–ç•¥
4. é€± 5-6ï¼šå¸³å‹™å¾®æœå‹™èˆ‡ RDS è¨­è¨ˆã€ç™¼ç¥¨ç”¢ç”Ÿæ¨£æ¿ã€æ”¯ä»˜æ•´åˆæ¸¬è©¦
5. é€± 7-8ï¼šæ¸¬è©¦ä¸Šç·šã€SLA æ¨¡æ“¬æ¸¬è©¦ã€æ–‡ä»¶èˆ‡ Runbook å®Œæˆ

## æˆæœ¬ä¼°ç®—ï¼ˆé«˜éšï¼‰

- åˆå§‹ï¼šEKS / EC2 ç¯€é»ã€RDS åˆå§‹ã€å°é‡ S3 èˆ‡ CloudWatch æˆæœ¬
- é‹è¡Œï¼šEKS/Fargate è²»ç”¨ã€RDS é¡¯è‘—å æ¯”ã€ä»˜è²»ç›£æ§/å‘Šè­¦ï¼ˆPagerDuty/ç¬¬ä¸‰æ–¹ï¼‰
- å»ºè­°åœ¨ PoC éšæ®µå…ˆä»¥ä½è¦æ ¼éƒ¨ç½²ä¸¦è§€å¯Ÿä½¿ç”¨é‡å†èª¿æ•´

## é©—æ”¶èˆ‡æ¸¬è©¦

- åŠŸèƒ½æ¸¬è©¦ï¼šMeraki Webhook -> Lambda è™•ç† -> Prometheus å¯è¦‹
- æ€§èƒ½æ¸¬è©¦ï¼šåœ¨å¤šç§Ÿæˆ¶æƒ…æ³ä¸‹æ¸¬è©¦æ”¶é›†å°ºåº¦èˆ‡ DB è² è¼‰
- éšœç¤™æ¼”ç·´ï¼šæ¨¡æ“¬è¨­å‚™å¤§é‡é›¢ç·šã€ç¶²è·¯æ–·éˆï¼Œé©—è­‰å‘Šè­¦èˆ‡å›å¾©æµç¨‹

## ä¸‹ä¸€æ­¥ï¼ˆçŸ­æœŸå„ªå…ˆé …ï¼‰

1. è¨‚å®šè¨ˆåƒ¹æ¨¡å‹ç¯„æœ¬èˆ‡è©¦ç®—è¡¨ï¼ˆä¾›å•†å‹™èˆ‡æ³•å‹™ç¢ºèªï¼‰
2. åœ¨ AWS å»ºç«‹ PoC å¸³è™Ÿï¼Œéƒ¨ç½²æœ€å°ç›£æ§ç®¡ç·šä¸¦ä¸²æ¥ä¸€å€‹ Meraki æ¸¬è©¦çµ„ç¹”
3. æ’°å¯« Runbook çš„ç¬¬ä¸€ç‰ˆï¼ˆå‰ä¸‰å€‹é«˜é »äº‹ä»¶ï¼‰

## é™„éŒ„ï¼šæ•´åˆè¦é»

- Meraki Dashboard APIï¼šä½¿ç”¨ API Key æˆ– OAuth ä¸¦é™åˆ¶æ¬Šé™èˆ‡ IP
- Webhook è™•ç†ï¼šç¢ºä¿é‡è©¦æ©Ÿåˆ¶èˆ‡å»é‡é‚è¼¯
- ç™¼ç¥¨æª”ï¼ˆPDFï¼‰å„²å­˜åœ¨ S3ï¼Œä¸¦ä½¿ç”¨ Signed URL ç™¼é€çµ¦å®¢æˆ¶ï¼ˆéæœŸé€£çµï¼‰

---

é©—æ”¶æ‘˜è¦ï¼šæœ¬ README.md æä¾›å¾é«˜éšç­–ç•¥åˆ°æŠ€è¡“å¯¦ä½œçš„ç«¯åˆ°ç«¯ç‡Ÿé‹è¨ˆç•«è‰æ¡ˆï¼ŒåŒ…å«æœå‹™ç›£æ§ã€å¸³å‹™ç®¡ç†èˆ‡ AWS æ¶æ§‹å»ºè­°ã€‚ä¸‹ä¸€æ­¥ç‚º PoC éƒ¨ç½²ã€è¨ˆåƒ¹æ¨¡å‹ç¢ºèªèˆ‡ Runbook æ’°å¯«ã€‚

## å°ˆæ¡ˆæ¶æ§‹èˆ‡å¿«é€Ÿå°èˆª

æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„ MSP ç‡Ÿé‹æ¶æ§‹èˆ‡å·¥å…·éˆï¼Œæ‰€æœ‰çµ„ä»¶é è¨­ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æ§åˆ¶å¤–éƒ¨é€£ç·šï¼Œå¯åœ¨æœ¬åœ°å®Œæ•´æ¸¬è©¦ã€‚

### å¿«é€Ÿé–‹å§‹æŒ‡å—

1. ç›£æ§å †ç–Šï¼ˆPrometheus + Grafanaï¼‰ï¼š
```bash
# åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„
make poc-up              # å•Ÿå‹• Prometheus + Grafana + Pushgateway
open http://localhost:3000  # è¨ªå• Grafanaï¼ˆadmin/adminï¼‰
```

2. Webhook æ¥æ”¶èˆ‡æ¸¬è©¦ï¼š
```bash
make poc-server         # å•Ÿå‹•æœ¬åœ° webhook handler
# åœ¨å¦ä¸€å€‹ terminalï¼š
make poc-test          # ç™¼é€æ¸¬è©¦ webhook
# æŸ¥çœ‹ server log ç¢ºèªæ¥æ”¶
```

3. å¸³å‹™æœå‹™ï¼ˆæœ¬åœ°ç‰ˆï¼‰ï¼š
```bash
cd billing
python3 -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt
FLASK_APP=app.py flask run

# åœ¨å¦ä¸€å€‹ terminal æ¸¬è©¦ APIï¼š
# å»ºç«‹å®¢æˆ¶
curl -X POST http://localhost:5000/customers \
  -H "Content-Type: application/json" \
  -d '{"name":"æ¸¬è©¦å…¬å¸","billing_contact":"billing@example.com"}'

# å»ºç«‹è¨‚é–±
curl -X POST http://localhost:5000/subscriptions \
  -H "Content-Type: application/json" \
  -d '{"customer_id":1,"sku":"MX-L","quantity":2,"unit_price":100}'

# ç”¢ç”Ÿç™¼ç¥¨
curl -X POST http://localhost:5000/invoices/generate \
  -H "Content-Type: application/json" \
  -d '{"billing_cycle":"2025-11"}'
```

### å°ˆæ¡ˆç›®éŒ„çµæ§‹

```
MSP_Operations_Plan_20251105/
â”œâ”€â”€ docs/                    # ğŸ“š å°ˆæ¡ˆæ–‡ä»¶
â”‚   â”œâ”€â”€ architecture/       # ç³»çµ±æ¶æ§‹åœ–èˆ‡èªªæ˜
â”‚   â””â”€â”€ api/               # API æ–‡ä»¶
â”œâ”€â”€ sop/                    # ğŸ“‹ æ¨™æº–ä½œæ¥­ç¨‹åº
â”‚   â”œâ”€â”€ sop.md             # ä¸»è¦ SOPï¼ˆæ—¥å¸¸é‹ç¶­èˆ‡äº‹æ•…è™•ç†ï¼‰
â”‚   â”œâ”€â”€ onboarding/        # å®¢æˆ¶ä¸Šç·šç›¸é—œæ–‡ä»¶
â”‚   â””â”€â”€ acceptance/        # é©—æ”¶æ¸¬è©¦æ¸…å–®èˆ‡ç¨‹åº
â”œâ”€â”€ runbooks/               # ğŸ“– é‹ç¶­æ‰‹å†Š
â”‚   â”œâ”€â”€ device/            # è¨­å‚™ç›¸é—œè™•ç†ç¨‹åº
â”‚   â”œâ”€â”€ network/           # ç¶²è·¯å•é¡Œè™•ç†æŒ‡å—
â”‚   â””â”€â”€ billing/           # å¸³å‹™ç•°å¸¸è™•ç†æµç¨‹
â”œâ”€â”€ poc/                    # ğŸ§ª æ¦‚å¿µé©—è­‰
â”‚   â”œâ”€â”€ docker/            # Docker é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ webhook/           # Webhook è™•ç†å™¨
â”‚   â””â”€â”€ sam/               # AWS SAM éƒ¨ç½²æ¨¡æ¿
â”œâ”€â”€ billing/                # ğŸ’° å¸³å‹™ç³»çµ±
â”‚   â”œâ”€â”€ api/               # Flask API æœå‹™
â”‚   â”œâ”€â”€ models/            # è³‡æ–™æ¨¡å‹
â”‚   â””â”€â”€ invoices/          # ç™¼ç¥¨ç¯„æœ¬èˆ‡è¼¸å‡º
â””â”€â”€ iac/                    # ğŸ—ï¸ åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼
    â”œâ”€â”€ terraform/         # Terraform æ¨¡çµ„èˆ‡ç¯„æœ¬
    â””â”€â”€ examples/          # éƒ¨ç½²ç¯„ä¾‹èˆ‡è®Šæ•¸é…ç½®
```

#### 1. ç‡Ÿé‹æ–‡ä»¶ï¼ˆ`sop/`ï¼‰
- [`sop/sop.md`](sop/sop.md) - ğŸ“‹ ä¸»è¦ SOPï¼ˆæ—¥å¸¸é‹ç¶­èˆ‡äº‹æ•…è™•ç†ï¼‰
- [`sop/onboarding/checklist.md`](sop/onboarding/checklist.md) - âœ… å®¢æˆ¶ä¸Šç·šæµç¨‹
- [`sop/acceptance/tests.md`](sop/acceptance/tests.md) - ğŸ” é©—æ”¶æ¸¬è©¦æ¸…å–®

#### 2. é‹ç¶­æ‰‹å†Šï¼ˆ`runbooks/`ï¼‰
- [`runbooks/device/offline.md`](runbooks/device/offline.md) - ğŸ”Œ è¨­å‚™é›¢ç·šè™•ç†
- [`runbooks/network/vpn.md`](runbooks/network/vpn.md) - ğŸŒ VPN ä¸­æ–·è™•ç†
- [`runbooks/billing/invoice.md`](runbooks/billing/invoice.md) - ğŸ“ ç™¼ç¥¨ç•°å¸¸è™•ç†

#### 3. ç¨‹å¼ç¢¼èˆ‡å¯¦ä½œï¼ˆ`poc/`, `billing/`, `iac/`ï¼‰
- [`poc/README.md`](poc/README.md) - ğŸ§ª PoC å¯¦ä½œèªªæ˜
  - Webhook handler + ç›£æ§å †ç–Š
  - æœ¬åœ°æ¸¬è©¦ç’°å¢ƒé…ç½®
  - AWS éƒ¨ç½²åƒè€ƒ

- [`billing/README.md`](billing/README.md) - ğŸ’° å¸³å‹™æœå‹™
  - RESTful API è¨­è¨ˆ
  - è³‡æ–™åº«çµæ§‹èªªæ˜
  - æœ¬åœ°é–‹ç™¼æŒ‡å—

- [`iac/terraform/README.md`](iac/terraform/README.md) - ğŸ—ï¸ åŸºç¤è¨­æ–½
  - AWS è³‡æºé…ç½®
  - å®‰å…¨æ€§è€ƒé‡
  - CI/CD æ•´åˆå»ºè­°

### ç’°å¢ƒè®Šæ•¸èˆ‡å¤–éƒ¨é€£ç·š

æ‰€æœ‰å¤–éƒ¨æœå‹™é€£ç·šå‡ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æ§åˆ¶ï¼š
- Meraki APIï¼š`MERAKI_API_URL`, `MERAKI_API_KEY`
- Prometheusï¼š`PROMETHEUS_PUSHGATEWAY`
- å¸³å‹™ç›¸é—œï¼š`BILLING_DB`, `INVOICE_DIR`

â¡ï¸ è¤‡è£½å°æ‡‰ç›®éŒ„ä¸‹çš„ `.env.example` ç‚º `.env` ä¸¦ä¾éœ€æ±‚é…ç½®ã€‚
âš ï¸ é è¨­ä¸è‡ªå‹•é€£æ¥ AWS æˆ–å¤–éƒ¨ APIã€‚

### å¾ŒçºŒæ“´å……å»ºè­°

1. ç›£æ§å ±è¡¨ï¼š
   - åœ¨ Grafana å»ºç«‹è¨­å‚™å¥åº·åº¦å„€è¡¨æ¿
   - è¨­å®š AlertManager è¦å‰‡èˆ‡é€šçŸ¥
   
2. å¸³å‹™åŠŸèƒ½ï¼š
   - æ•´åˆ PDF ç™¼ç¥¨ç”Ÿæˆ
   - ä¸²æ¥å¯¦éš›æ”¯ä»˜ç³»çµ±
   
3. AWS éƒ¨ç½²ï¼š
   - ä½¿ç”¨ SAM éƒ¨ç½² Lambda
   - è¨­å®š VPC endpoint èˆ‡å®‰å…¨çµ„
   
è©³ç´°èªªæ˜è«‹æŸ¥çœ‹å„ç›®éŒ„ä¸‹çš„ READMEã€‚

## Prometheus + Grafana PoC (å¿«é€Ÿåƒè€ƒ)

æœ¬å°ˆæ¡ˆåœ¨ `poc/` ç›®éŒ„ä¸‹æä¾›å…©å¥— Prometheus + Grafana çš„ PoCï¼š

- é›²ç«¯ (cloud): `poc/prometheus-cloud/`ï¼Œç¤ºç¯„åœ¨é›²ç«¯ Kubernetes ä½¿ç”¨ LoadBalancer èˆ‡ PVC çš„éƒ¨ç½²ç¯„ä¾‹ã€‚
- åœ°ç«¯ (edge): `poc/prometheus-edge/`ï¼Œç¤ºç¯„åœ¨ç„¡é›²ç«¯ LB çš„ç’°å¢ƒä½¿ç”¨ NodePort èˆ‡ hostPath (PoC ç”¨) çš„è¨­å®šã€‚

å¿«é€Ÿé©—è­‰æ­¥é©Ÿï¼š

1. ä¾ç…§æ‰€é¸å¢é›† (`kubeconfig`) éƒ¨ç½²ï¼š

```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo update
kubectl create namespace monitoring
# Cloud ç¯„ä¾‹
helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring -f poc/prometheus-cloud/values-cloud.yaml
# Edge ç¯„ä¾‹
helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring -f poc/prometheus-edge/values-edge.yaml
```

2. å°‡ç¤ºä¾‹ Grafana dashboard èˆ‡ sidecar-provisioning çš„ ConfigMap å¥—ç”¨ï¼š

```bash
kubectl apply -f poc/grafana-dashboard-configmap.yaml
```

3. ä½¿ç”¨å…§å»ºçš„æª¢æŸ¥è…³æœ¬å¿«é€Ÿé©—è­‰ï¼š

```bash
chmod +x poc/check-prometheus.sh
poc/check-prometheus.sh monitoring
```

æ›´å¤šç´°ç¯€è«‹åƒè€ƒï¼š`poc/prometheus-cloud/README.md`ã€`poc/prometheus-edge/README.md` èˆ‡ `poc/prometheus-grafana-pocs.md`ã€‚
